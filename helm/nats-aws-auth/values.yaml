replicaCount: 2

image:
  repository: ghcr.io/portswigger-amason/nats-aws-auth
  pullPolicy: IfNotPresent
  tag: ""  # defaults to appVersion

serviceAccount:
  create: true
  name: nats-aws-auth
  annotations: {}
  # eks.amazonaws.com/role-arn: from SSM via helmfile

rbac:
  create: true  # ClusterRole for K8s SA read access

# AWS KMS configuration
kms:
  aliasPrefix: "nats"
  # region: ""  # uses SDK default
  appAccountKeyAlias: ""  # e.g. "nats-app-account". When set, uses stable KMS key for APP account

# NATS connection
nats:
  url: "nats://nats.messaging:4222"

# Account names
accounts:
  operator: "KMS-Operator"
  sys: "SYS"
  auth: "AUTH"
  app: "APP"

# Auth backend
auth:
  backend: "k8s-oidc"  # or "allow-all"

# K8s OIDC config (when auth.backend = k8s-oidc)
jwt:
  issuer: ""  # REQUIRED: EKS OIDC issuer URL
  audience: "nats"
  jwksUrl: "https://kubernetes.default.svc/openid/v1/jwks"

# HTTP server
port: 8080

# Prometheus metrics
metrics:
  podMonitor:
    enabled: true
    # interval: 30s  # uses Prometheus default if unset

# Logging
logLevel: info

# Resources
resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    memory: 256Mi

# Security
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65532
  fsGroup: 65532

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop: ["ALL"]
  readOnlyRootFilesystem: true
